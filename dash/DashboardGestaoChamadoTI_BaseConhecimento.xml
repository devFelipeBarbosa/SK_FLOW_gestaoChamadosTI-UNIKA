<gadget ><prompt-parameters><parameter  id="P_DHINCLUSAO" description="Dh. Inclusão" metadata="datePeriod" required="true" keep-last="true" keep-date="false" show-inactives="false" label="P_DHINCLUSAO : Período" order="0"/><parameter  id="P_DHCONCLUSAO" description="Dh. Conclusão" metadata="datePeriod" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_DHCONCLUSAO : Período" order="1"/><parameter  id="P_IDINSTPRN" description="Nro. Solicitação" metadata="integer" required="false" keep-last="true" keep-date="false" show-inactives="false" range-end="9999999999" range-ini="0" label="P_IDINSTPRN : Número Inteiro" order="2"/><parameter  id="P_BASECONHECIMENTO" description="Base Conhecimento?" metadata="singleList:Text" listType="text" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_BASECONHECIMENTO : singleList:Text" order="3"><item value="S" label="Sim"/><item value="N" label="Não"/></parameter><parameter  id="P_CODSOLICITANTE" description="Cód. Solicitante" metadata="entity:Usuario@CODUSU" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_CODSOLICITANTE : Entidade/Tabela" order="4"/><parameter  id="P_CODRESPONSAVEL" description="Cód. Responsável" metadata="entity:Usuario@CODUSU" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_CODRESPONSAVEL : Entidade/Tabela" order="5"/><parameter  id="P_ID_CATEGORIA" description="Cód. Categoria" metadata="entity:AD_CATEGORIATI@ID_CATEGORIATI" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_ID_CATEGORIA : Entidade/Tabela" order="6"/><parameter  id="P_DESCCATEGORIA" description="Desc. Categoria" metadata="text" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_DESCCATEGORIA : Texto" order="7"/><parameter  id="P_CODPROD" description="Produto" metadata="entity:Produto@CODPROD" required="false" keep-last="false" keep-date="false" show-inactives="false" label="P_CODPROD : Entidade/Tabela" order="8"/><parameter  id="P_CODPARC" description="Parceiro" metadata="entity:Parceiro@CODPARC" required="false" keep-last="false" keep-date="false" show-inactives="false" label="P_CODPARC : Entidade/Tabela" order="9"/><parameter  id="P_CODLOCAL" description="Localização" metadata="multiList:Text" listType="sql" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_CODLOCAL : multiList:Text" order="10"><expression type="SQL"><![CDATA[
        
        
        
        
        SELECT 
    CODLOCAL AS VALUE,
    CODLOCAL || ' - ' || DESCRLOCAL AS LABEL
FROM TGFLOC
WHERE ATIVO = 'S'
  AND ANALITICO = 'S'
  AND CODLOCAL BETWEEN 20000000 AND 29999999
ORDER BY CODLOCAL ASC
      
      
      
      
      ]]></expression></parameter><parameter  id="P_STATUSCHAMADO" description="Status Chamado" metadata="multiList:Text" listType="sql" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_STATUSCHAMADO : multiList:Text" order="11"><expression type="SQL"><![CDATA[
        
        
        
        
        SELECT DISTINCT CHA.STATUSCHAMADO AS VALUE
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='STATUSCHAMADO' AND OPC.VALOR = CHA.STATUSCHAMADO) AS LABEL
FROM AD_CHAMADOTI CHA
      
      
      
      
      ]]></expression></parameter><parameter  id="P_TAREFA" description="Tarefa Atual" metadata="multiList:Text" listType="sql" required="false" keep-last="true" keep-date="false" show-inactives="false" label="P_TAREFA : multiList:Text" order="12"><expression type="SQL"><![CDATA[
        
        
        
        
        SELECT DISTINCT NVL(VWS.TAREFA_ATUAL, CASE WHEN CAB.SITUACAOEXEC = 'F' THEN 'Solic. Finalizada' Else 'Solic. Cancelada' END) AS VALUE, NVL(VWS.TAREFA_ATUAL, CASE WHEN CAB.SITUACAOEXEC = 'F' THEN 'Solic. Finalizada' Else 'Solic. Cancelada' END) AS LABEL FROM AD_CHAMADOTI CHA
INNER JOIN TWFIPRN CAB ON (CHA.IDINSTPRN = CAB.IDINSTPRN)
INNER JOIN TWFPRN PRN ON (CAB.CODPRN = PRN.CODPRN AND CAB.VERSAO = PRN.VERSAO)
INNER JOIN VWFSOLI VWS ON (VWS.IDINSTPRN = CHA.IDINSTPRN)
 LEFT JOIN AD_CATEGORIATI CAT ON (CAT.ID_CATEGORIATI = CHA.ID_CATEGORIATI)
 LEFT JOIN TGFLOC LOC ON (LOC.CODLOCAL = CHA.CODLOCAL)
ORDER BY 1 DESC
      
      
      
      
      ]]></expression></parameter></prompt-parameters><level id="023" description="Principal"><args><arg  id="V_IDINSTPRN" type="integer" label="V_IDINSTPRN : Número Inteiro"/></args><container orientacao="H" tamanhoRelativo="100"><container orientacao="V" tamanhoRelativo="13.932427725531172"><simple-value id="svl_02K"><expression type="sql" data-source="MGEDS"><![CDATA[SELECT 
 COUNT(IDINSTPRN) AS QTDCHAMADOS 
, SUM(CASE WHEN STATUSCHAMADO IN('A','N') THEN 1 ELSE 0 END) AS QTDNOVOS 
, SUM(CASE WHEN STATUSCHAMADO = 'T' THEN 1 ELSE 0 END) AS QTDTRIAGEM 
, SUM(CASE WHEN STATUSCHAMADO = 'C' THEN 1 ELSE 0 END) AS QTDCANCELADOS
, SUM(CASE WHEN STATUSCHAMADO = 'E' THEN 1 ELSE 0 END) AS QTDEMATENDIMENTO
, SUM(CASE WHEN STATUSCHAMADO = 'O' THEN 1 ELSE 0 END) AS QTDTERCEIRO
, SUM(CASE WHEN STATUSCHAMADO = 'F' THEN 1 ELSE 0 END) AS QTDEMAPROVACAO
, SUM(CASE WHEN STATUSCHAMADO = 'K' THEN 1 ELSE 0 END) AS QTDFINALIZADA

FROM (

SELECT 
 CAB.IDINSTPRN
,CAB.DHINCLUSAO
,CAB.DHCONCLUSAO
,PRN.CODPRN
,PRN.NOME 
,NVL(VWS.TAREFA_ATUAL, CASE WHEN CAB.SITUACAOEXEC = 'F' THEN 'Solic. Finalizada' Else 'Solic. Cancelada' END) AS TAREFA_ATUAL
,CHA.STATUSCHAMADO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='STATUSCHAMADO' AND OPC.VALOR = CHA.STATUSCHAMADO) AS DESCSTATUS
,CAB.CODUSUINC AS SOLICITANTE
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = CAB.CODUSUINC) AS NOMESOL
,ROUND(VWS.RESPONSAVEL_TAREFA_ATUAL) AS RESPONSAVEL
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = VWS.RESPONSAVEL_TAREFA_ATUAL) AS NOMERESPONSAVEL
,CAB.SITUACAOEXEC
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='TWFIPRN' AND NOMECAMPO='SITUACAOEXEC' AND OPC.VALOR = CAB.SITUACAOEXEC) AS DESCSITUACAO
,CHA.TIPO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='TIPO' AND OPC.VALOR = CHA.TIPO) AS DESCTIPO
,CHA.ID_CATEGORIATI
,CAT.DESCRICAO AS CATEGORIA
,CHA.CODLOCAL
,LOC.DESCRLOCAL
,CHA.ORIGEMCHAMADO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='ORIGEMCHAMADO' AND OPC.VALOR = CHA.ORIGEMCHAMADO) AS DESCORIGEM
,CHA.URGENCIA
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='URGENCIA' AND OPC.VALOR = CHA.URGENCIA) AS DESCURGENCIA
,CHA.IMPACTO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='IMPACTO' AND OPC.VALOR = CHA.IMPACTO) AS DESCIMPACTO
,CHA.PRIORIDADE
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='PRIORIDADE' AND OPC.VALOR = CHA.PRIORIDADE) AS DESCPRIORIDADE
,NVL(VWS.TEMPO_FILA, 0) AS TEMPO_FILA
,NVL(VWS.TEMPO_ATENDIMENTO, 0) AS TEMPO_ATENDIMENTO
,NVL(VWS.TEMPO_EXECUCAO, 0) AS TEMPO_EXECUCAO
,NVL(VWS.EFIC_EXECUCAO, 0) * 100 AS EFIC_EXECUCAO
,NVL(VWS.EFIC_FILA, 0) * 100 AS EFIC_FILA

FROM AD_CHAMADOTI CHA
INNER JOIN TWFIPRN CAB ON (CHA.IDINSTPRN = CAB.IDINSTPRN)
INNER JOIN TWFPRN PRN ON (CAB.CODPRN = PRN.CODPRN AND CAB.VERSAO = PRN.VERSAO)
INNER JOIN VWFSOLI VWS ON (VWS.IDINSTPRN = CHA.IDINSTPRN)
 LEFT JOIN AD_CATEGORIATI CAT ON (CAT.ID_CATEGORIATI = CHA.ID_CATEGORIATI)
 LEFT JOIN TGFLOC LOC ON (LOC.CODLOCAL = CHA.CODLOCAL)

WHERE 
(CAB.DHINCLUSAO >= :P_DHINCLUSAO.INI AND CAB.DHINCLUSAO <= TO_DATE(:P_DHINCLUSAO.FIN))
AND ((CAB.DHCONCLUSAO >= :P_DHCONCLUSAO.INI OR :P_DHCONCLUSAO.INI IS NULL) AND (CAB.DHCONCLUSAO <= TO_DATE(:P_DHCONCLUSAO.FIN) OR :P_DHCONCLUSAO.FIN IS NULL))
AND (CHA.IDINSTPRN = :P_IDINSTPRN OR :P_IDINSTPRN IS NULL)
AND (CAB.CODUSUINC = :P_CODSOLICITANTE OR :P_CODSOLICITANTE IS NULL)
AND (VWS.RESPONSAVEL_TAREFA_ATUAL = :P_CODRESPONSAVEL OR :P_CODRESPONSAVEL IS NULL)
AND (CHA.ID_CATEGORIATI = :P_ID_CATEGORIA OR :P_ID_CATEGORIA IS NULL)
AND (
      :P_DESCCATEGORIA IS NULL 
      OR TRIM(:P_DESCCATEGORIA) = '' 
      OR UPPER(CAT.DESCRICAO) LIKE '%' || UPPER(TRIM(:P_DESCCATEGORIA)) || '%'
    )
AND (CHA.CODLOCAL IN :P_CODLOCAL)
AND (CHA.STATUSCHAMADO IN :P_STATUSCHAMADO) ORDER BY 1 DESC) SUB
WHERE  (SUB.TAREFA_ATUAL IN :P_TAREFA)]]></expression><metadata><field name="QTDCHAMADOS" label="QTDCHAMADOS" type="I" visible="true" useFooter="false"></field><field name="QTDNOVOS" label="QTDNOVOS" type="I" visible="true" useFooter="false"></field><field name="QTDTRIAGEM" label="QTDTRIAGEM" type="I" visible="true" useFooter="false"></field><field name="QTDCANCELADOS" label="QTDCANCELADOS" type="I" visible="true" useFooter="false"></field><field name="QTDEMATENDIMENTO" label="QTDEMATENDIMENTO" type="I" visible="true" useFooter="false"></field><field name="QTDTERCEIRO" label="QTDTERCEIRO" type="I" visible="true" useFooter="false"></field><field name="QTDEMAPROVACAO" label="QTDEMAPROVACAO" type="I" visible="true" useFooter="false"></field><field name="QTDFINALIZADA" label="QTDFINALIZADA" type="I" visible="true" useFooter="false"></field></metadata><value-expression><![CDATA[<div style="
    display: flex;
    flex-direction: row;
    align-items: stretch;
    font-family: 'Segoe UI', Arial, sans-serif;
">
            <!-- COLUNA VERTICAL DOS CARDS -->
            <div style="
        display: flex;
        flex-direction: column;
        gap: 14px;
    ">
              <!-- TOTAL -->
              <div style="
            background: linear-gradient(135deg, #ffe082, #ffca28);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Total</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDCHAMADOS</div>
                <div style="font-size: 13px; font-weight: 500;"> Chamados</div>
              </div>

              <!-- NOVOS -->
              <div style="
            background: linear-gradient(135deg, #c8e6c9, #66bb6a);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Novos/Ajuste</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDNOVOS</div>
                <div style="font-size: 13px; font-weight: 500;">Chamados novos</div>
              </div>

              <!-- TRIAGEM -->
              <div style="
            background: linear-gradient(135deg, #bbdefb, #42a5f5);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Triagem</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDTRIAGEM</div>
                <div style="font-size: 13px; font-weight: 500;">Chamados em triagem</div>
              </div>

              <!-- EM ATENDIMENTO -->
              <div style="
            background: linear-gradient(135deg, #d1c4e9, #7e57c2);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Atendimento</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDEMATENDIMENTO</div>
                <div style="font-size: 13px; font-weight: 500;">Em atendimento</div>
              </div>

              <!-- TERCEIRO -->
              <div style="
            background: linear-gradient(135deg, #ffccbc, #ff7043);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Terceiro</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDTERCEIRO</div>
                <div style="font-size: 13px; font-weight: 500;">Com terceiro</div>
              </div>

              <!-- APROVAÇÃO -->
              <div style="
            background: linear-gradient(135deg, #fff59d, #fdd835);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Aprovação</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDEMAPROVACAO</div>
                <div style="font-size: 13px; font-weight: 500;">Em aprovação</div>
              </div>

              <!-- FINALIZADO -->
              <div style="
            background: linear-gradient(135deg, #cfd8dc, #90a4ae);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Finalizado</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDFINALIZADA</div>
                <div style="font-size: 13px; font-weight: 500;">Finalizados</div>
              </div>

              <!-- CANCELADOS -->
              <div style="
            background: linear-gradient(135deg, #ffcdd2, #ef5350);
            border-radius: 10px;
            padding: 10px 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.15);
            width: 170px;
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        ">
                <div style="font-size: 11px; text-transform: uppercase; letter-spacing: .5px; font-weight: 600; opacity: 0.7;">Cancelados</div>
                <div style="font-size: 28px; font-weight: 700; margin: 4px 0;">$QTDCANCELADOS</div>
                <div style="font-size: 13px; font-weight: 500;">Cancelados</div>
              </div>

            </div>

<!-- BARRA LATERAL CONTÍNUA -->
 <div style="
        width: 3px;
        background: #e2e2e2;
        margin-left: 14px;
        border-radius: 2px;
    ">
            </div>
          </div>]]></value-expression></simple-value></container><container orientacao="V" tamanhoRelativo="87.07767328456984"><container orientacao="H" tamanhoRelativo="59.18978141200362"><container orientacao="H" tamanhoRelativo="59.78765799192285"><container orientacao="H" tamanhoRelativo="99.02171319494155"><grid id="grd_02E" useNewGrid="S"><title><![CDATA[<b>Lista de Solicitações</b>]]></title><expression type="sql" data-source="MGEDS"><![CDATA[SELECT * FROM (

SELECT 
 CAB.IDINSTPRN
,CAB.DHINCLUSAO
,CAB.DHCONCLUSAO
,PRN.CODPRN
,PRN.NOME 
,NVL(VWS.TAREFA_ATUAL, CASE WHEN CAB.SITUACAOEXEC = 'F' THEN 'Solic. Finalizada' Else 'Solic. Cancelada' END) AS TAREFA_ATUAL
,CHA.STATUSCHAMADO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='STATUSCHAMADO' AND OPC.VALOR = CHA.STATUSCHAMADO) AS DESCSTATUS
,CAB.CODUSUINC AS SOLICITANTE
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = CAB.CODUSUINC) AS NOMESOL
,ROUND(VWS.RESPONSAVEL_TAREFA_ATUAL) AS RESPONSAVEL
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = VWS.RESPONSAVEL_TAREFA_ATUAL) AS NOMERESPONSAVEL
,CAB.SITUACAOEXEC
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='TWFIPRN' AND NOMECAMPO='SITUACAOEXEC' AND OPC.VALOR = CAB.SITUACAOEXEC) AS DESCSITUACAO
,CHA.TIPO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='TIPO' AND OPC.VALOR = CHA.TIPO) AS DESCTIPO
,CHA.ID_CATEGORIATI
,CAT.DESCRICAO AS CATEGORIA
,CHA.CODLOCAL
,LOC.DESCRLOCAL
,CHA.ORIGEMCHAMADO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='ORIGEMCHAMADO' AND OPC.VALOR = CHA.ORIGEMCHAMADO) AS DESCORIGEM
,CHA.URGENCIA
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='URGENCIA' AND OPC.VALOR = CHA.URGENCIA) AS DESCURGENCIA
,CHA.IMPACTO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='IMPACTO' AND OPC.VALOR = CHA.IMPACTO) AS DESCIMPACTO
,CHA.PRIORIDADE
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='PRIORIDADE' AND OPC.VALOR = CHA.PRIORIDADE) AS DESCPRIORIDADE
,NVL(VWS.TEMPO_FILA, 0) AS TEMPO_FILA
,NVL(VWS.TEMPO_ATENDIMENTO, 0) AS TEMPO_ATENDIMENTO
,NVL(VWS.TEMPO_EXECUCAO, 0) AS TEMPO_EXECUCAO
,NVL(VWS.EFIC_EXECUCAO, 0) * 100 AS EFIC_EXECUCAO
,NVL(VWS.EFIC_FILA, 0) * 100 AS EFIC_FILA

FROM AD_CHAMADOTI CHA
INNER JOIN TWFIPRN CAB ON (CHA.IDINSTPRN = CAB.IDINSTPRN)
INNER JOIN TWFPRN PRN ON (CAB.CODPRN = PRN.CODPRN AND CAB.VERSAO = PRN.VERSAO)
INNER JOIN VWFSOLI VWS ON (VWS.IDINSTPRN = CHA.IDINSTPRN)
 LEFT JOIN AD_CATEGORIATI CAT ON (CAT.ID_CATEGORIATI = CHA.ID_CATEGORIATI)
 LEFT JOIN TGFLOC LOC ON (LOC.CODLOCAL = CHA.CODLOCAL)

WHERE 
(CAB.DHINCLUSAO >= :P_DHINCLUSAO.INI AND CAB.DHINCLUSAO <= TO_DATE(:P_DHINCLUSAO.FIN))
AND ((CAB.DHCONCLUSAO >= :P_DHCONCLUSAO.INI OR :P_DHCONCLUSAO.INI IS NULL) AND (CAB.DHCONCLUSAO <= TO_DATE(:P_DHCONCLUSAO.FIN) OR :P_DHCONCLUSAO.FIN IS NULL))
AND (CHA.IDINSTPRN = :P_IDINSTPRN OR :P_IDINSTPRN IS NULL)
AND (CAB.CODUSUINC = :P_CODSOLICITANTE OR :P_CODSOLICITANTE IS NULL)
AND (VWS.RESPONSAVEL_TAREFA_ATUAL = :P_CODRESPONSAVEL OR :P_CODRESPONSAVEL IS NULL)
AND (CHA.ID_CATEGORIATI = :P_ID_CATEGORIA OR :P_ID_CATEGORIA IS NULL)
AND (
      :P_DESCCATEGORIA IS NULL 
      OR TRIM(:P_DESCCATEGORIA) = '' 
      OR UPPER(CAT.DESCRICAO) LIKE '%' || UPPER(TRIM(:P_DESCCATEGORIA)) || '%'
    )
AND (CHA.CODLOCAL IN :P_CODLOCAL)
AND (CHA.STATUSCHAMADO IN :P_STATUSCHAMADO) 
AND (
      :P_CODPROD IS NULL
      OR EXISTS (
            SELECT 1
              FROM AD_HISTORICOSOLUCOES HIS
             WHERE HIS.IDINSTPRN = CHA.IDINSTPRN
               AND HIS.CODPROD   = :P_CODPROD
      )
    )
    AND (
          :P_CODPARC IS NULL
          OR EXISTS (
                SELECT 1
                  FROM AD_HISTORICOSOLUCOES HIS
                 WHERE HIS.IDINSTPRN = CHA.IDINSTPRN
                   AND HIS.CODPARC   = :P_CODPARC   -- ajuste o nome do campo se for diferente
          )
        )
ORDER BY 1 DESC) SUB
WHERE  (SUB.TAREFA_ATUAL IN :P_TAREFA)]]></expression><metadata><field name="IDINSTPRN" label="Nro. Solicitação" type="I" visible="true" useFooter="false"></field><field name="DHINCLUSAO" label="Dh. Inclusão" type="T" visible="true" useFooter="false"></field><field name="DHCONCLUSAO" label="Dh. Conclusão" type="T" visible="true" useFooter="false"></field><field name="CODPRN" label="Cód. Processo" type="I" visible="true" useFooter="false"></field><field name="NOME" label="Processo" type="S" visible="true" useFooter="false"></field><field name="TAREFA_ATUAL" label="Tarefa Atual" type="S" visible="true" useFooter="false"></field><field name="STATUSCHAMADO" label="Status Chamado" type="S" visible="true" useFooter="false"></field><field name="DESCSTATUS" label="Desc. Status" type="S" visible="true" useFooter="false"></field><field name="SOLICITANTE" label="Cód. Solicitante" type="I" visible="false" useFooter="false"></field><field name="NOMESOL" label="Nome Solicitante" type="S" visible="true" useFooter="false"></field><field name="RESPONSAVEL" label="Resp. Atual" type="I" visible="false" useFooter="false"></field><field name="NOMERESPONSAVEL" label="Nome Resp. Atual" type="S" visible="true" useFooter="false"></field><field name="SITUACAOEXEC" label="Cód. Situação" type="S" visible="false" useFooter="false"></field><field name="DESCSITUACAO" label="Situação Execução" type="S" visible="true" useFooter="false"></field><field name="TIPO" label="Cód. Tipo" type="S" visible="false" useFooter="false"></field><field name="DESCTIPO" label="Tipo" type="S" visible="true" useFooter="false"></field><field name="ID_CATEGORIATI" label="Cód. Categoria" type="I" visible="true" useFooter="false"></field><field name="CATEGORIA" label="Categoria" type="S" visible="true" useFooter="false"></field><field name="CODLOCAL" label="Cód. Local" type="I" visible="true" useFooter="false"></field><field name="DESCRLOCAL" label="Local" type="S" visible="true" useFooter="false"></field><field name="ORIGEMCHAMADO" label="Cód. Origem" type="S" visible="false" useFooter="false"></field><field name="DESCORIGEM" label="Origem Chamado" type="S" visible="true" useFooter="false"></field><field name="URGENCIA" label="Cód. Urgência" type="S" visible="false" useFooter="false"></field><field name="DESCURGENCIA" label="Urgência" type="S" visible="true" useFooter="false"></field><field name="IMPACTO" label="Cód. Impacto" type="S" visible="false" useFooter="false"></field><field name="DESCIMPACTO" label="Impacto" type="S" visible="true" useFooter="false"></field><field name="PRIORIDADE" label="Cód. Prioridade" type="S" visible="false" useFooter="false"></field><field name="DESCPRIORIDADE" label="Prioridade" type="S" visible="true" useFooter="false"></field><field name="TEMPO_FILA" label="Tempo Fila" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field><field name="TEMPO_ATENDIMENTO" label="Tempo Atendimento" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field><field name="TEMPO_EXECUCAO" label="Tempo Execução" type="F" visible="true" useFooter="SUM" mask="#.##0,00;-n"></field><field name="EFIC_EXECUCAO" label="Eficiência Exec." type="F" visible="true" useFooter="false" mask="#.##0,00 %"></field><field name="EFIC_FILA" label="Eficiência Fila" type="F" visible="true" useFooter="false" mask="#.##0,00 %"></field></metadata><refresh-details  ui-list="svl_1EI,grd_095">
                <param id="V_IDINSTPRN">$IDINSTPRN</param>
              </refresh-details></grid></container><container orientacao="H" tamanhoRelativo="1.9883878151594687"></container></container><container orientacao="V" tamanhoRelativo="41.41406990256548"><simple-value id="svl_1EI"><args><arg id="V_IDINSTPRN" type="integer"></arg></args><expression type="sql" data-source="MGEDS"><![CDATA[SELECT 
 CAB.IDINSTPRN
,CAB.DHINCLUSAO
,CAB.DHCONCLUSAO
,PRN.CODPRN
,PRN.NOME 
,NVL(VWS.TAREFA_ATUAL, CASE WHEN CAB.SITUACAOEXEC = 'F' THEN 'Solic. Finalizada' Else 'Solic. Cancelada' END) AS TAREFA_ATUAL
,CHA.STATUSCHAMADO
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_CHAMADOTI' AND NOMECAMPO='STATUSCHAMADO' AND OPC.VALOR = CHA.STATUSCHAMADO) AS DESCSTATUS
,CAB.CODUSUINC AS SOLICITANTE
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = CAB.CODUSUINC) AS NOMESOL
,ROUND(VWS.RESPONSAVEL_TAREFA_ATUAL) AS RESPONSAVEL
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = VWS.RESPONSAVEL_TAREFA_ATUAL) AS NOMERESPONSAVEL
,CHA.TITULO
,CHA.TEXTOCHAMADO

FROM AD_CHAMADOTI CHA
INNER JOIN TWFIPRN CAB ON (CHA.IDINSTPRN = CAB.IDINSTPRN)
INNER JOIN TWFPRN PRN ON (CAB.CODPRN = PRN.CODPRN AND CAB.VERSAO = PRN.VERSAO)
INNER JOIN VWFSOLI VWS ON (VWS.IDINSTPRN = CHA.IDINSTPRN)
 LEFT JOIN AD_CATEGORIATI CAT ON (CAT.ID_CATEGORIATI = CHA.ID_CATEGORIATI)
 LEFT JOIN TGFLOC LOC ON (LOC.CODLOCAL = CHA.CODLOCAL)
 WHERE CHA.IDINSTPRN = :V_IDINSTPRN
ORDER BY 1 DESC]]></expression><metadata><field name="IDINSTPRN" label="IDINSTPRN" type="I" visible="true" useFooter="false"></field><field name="DHINCLUSAO" label="DHINCLUSAO" type="D" visible="true" useFooter="false"></field><field name="DHCONCLUSAO" label="DHCONCLUSAO" type="D" visible="true" useFooter="false"></field><field name="CODPRN" label="CODPRN" type="I" visible="true" useFooter="false"></field><field name="NOME" label="NOME" type="S" visible="true" useFooter="false"></field><field name="TAREFA_ATUAL" label="TAREFA_ATUAL" type="S" visible="true" useFooter="false"></field><field name="STATUSCHAMADO" label="STATUSCHAMADO" type="S" visible="true" useFooter="false"></field><field name="DESCSTATUS" label="DESCSTATUS" type="S" visible="true" useFooter="false"></field><field name="SOLICITANTE" label="SOLICITANTE" type="I" visible="true" useFooter="false"></field><field name="NOMESOL" label="NOMESOL" type="S" visible="true" useFooter="false"></field><field name="RESPONSAVEL" label="RESPONSAVEL" type="I" visible="true" useFooter="false"></field><field name="NOMERESPONSAVEL" label="NOMERESPONSAVEL" type="S" visible="true" useFooter="false"></field><field name="TITULO" label="TITULO" type="S" visible="true" useFooter="false"></field><field name="TEXTOCHAMADO" label="TEXTOCHAMADO" type="S" visible="true" useFooter="false"></field></metadata><value-expression><![CDATA[<div style="
    font-family: 'Segoe UI', Arial, sans-serif;
    font-size: 13px;
    color: #333;
    background: #ffffff;
    border-radius: 6px;
    padding: 16px 18px;
    box-shadow: 0 0 4px rgba(0,0,0,0.08);
    box-sizing: border-box;">
              <div style="font-size: 12px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: .5px;">Detalhes da Solicitação</div>
              <div style="height: 1px; background: #eee; margin: 8px 0 10px;">
              </div>
              <div style="font-size: 16px; font-weight: 600; margin-bottom: 10px; color: #0000FF;">Título: $TITULO</div>
              <div style=" background: #f5f5f5;
border-radius: 6px;
padding: 12px 14px;
font-size: 14px;
line-height: 1.5;
color: #333;
white-space: normal;
border: 1px solid #e2e2e2;
    ">
                <b>Descrição:</b>
                <br>$TEXTOCHAMADO</div>
              </div>]]></value-expression></simple-value></container></container><container orientacao="H" tamanhoRelativo="41.820319598097385"><container orientacao="H" tamanhoRelativo="59.1976408969873"><container orientacao="H" tamanhoRelativo="98.47428257470098"><grid id="grd_095" useNewGrid="S"><args><arg id="V_IDINSTPRN" type="integer"></arg></args><title><![CDATA[<b>Histórico de Soluções por Solicitação</b>]]></title><expression type="sql" data-source="MGEDS"><![CDATA[SELECT
 HIS.IDINSTPRN
,HIS.SEQUENCIA
,VWS.TAREFA_ATUAL
,HIS.DHALTER
,HIS.CODUSU
,(SELECT SOL.NOMEUSU FROM TSIUSU SOL WHERE SOL.CODUSU = HIS.CODUSU) AS NOME
,HIS.DESCSOLUCAO
,HIS.ID_PK
,HIS.CODPROD
,PRD.DESCRPROD
,(SELECT OPC.OPCAO FROM TDDCAM CAM INNER JOIN TDDOPC OPC ON (CAM.NUCAMPO=OPC.NUCAMPO) WHERE NOMETAB='AD_HISTORICOSOLUCOES' AND NOMECAMPO='TERCEIRO' AND OPC.VALOR = HIS.TERCEIRO) AS DESCSTATUS
,HIS.DTTERCEIRO
,HIS.CODPARC
,PAR.NOMEPARC
,HIS.DESCTERCEIRO
,HIS.BASECONHECIMENTO


FROM 
AD_HISTORICOSOLUCOES HIS 
INNER JOIN AD_CHAMADOTI CHA ON (CHA.IDINSTPRN = HIS.IDINSTPRN)
INNER JOIN VWFSOLI VWS ON (VWS.IDINSTPRN = CHA.IDINSTPRN)
 LEFT JOIN TGFPRO PRD ON (PRD.CODPROD = HIS.CODPROD)
 LEFT JOIN TGFPAR PAR ON (PAR.CODPARC = HIS.CODPARC)

WHERE HIS.IDINSTPRN = :V_IDINSTPRN AND HIS.BASECONHECIMENTO = :P_BASECONHECIMENTO
ORDER BY HIS.SEQUENCIA]]></expression><metadata><field name="IDINSTPRN" label="Nro. Solicitação" type="I" visible="true" useFooter="false"></field><field name="SEQUENCIA" label="Seq." type="I" visible="true" useFooter="false"></field><field name="TAREFA_ATUAL" label="Tarefa Atual" type="S" visible="true" useFooter="false"></field><field name="DHALTER" label="Dh. Alter." type="T" visible="true" useFooter="false"></field><field name="CODUSU" label="Cód. Usu. Alter." type="I" visible="true" useFooter="false"></field><field name="NOME" label="Nome Alter." type="S" visible="true" useFooter="false"></field><field name="DESCSOLUCAO" label="Descr. Solução" type="S" visible="true" useFooter="false"></field><field name="ID_PK" label="Id. Cad. TI" type="I" visible="true" useFooter="false"></field><field name="CODPROD" label="Cód. Produto" type="I" visible="true" useFooter="false"></field><field name="DESCRPROD" label="Produto" type="S" visible="true" useFooter="false"></field><field name="DESCSTATUS" label="Descr. Status" type="S" visible="true" useFooter="false"></field><field name="DTTERCEIRO" label="Dt. Terceiro" type="D" visible="true" useFooter="false"></field><field name="CODPARC" label="Cod. Parceiro" type="I" visible="true" useFooter="false"></field><field name="NOMEPARC" label="Parceiro" type="S" visible="true" useFooter="false"></field><field name="DESCTERCEIRO" label="Descr. Terceiro" type="S" visible="true" useFooter="false"></field><field name="BASECONHECIMENTO" label="Base Conhecimento" type="S" visible="true" useFooter="false"></field></metadata><refresh-details  ui-list="svl_2D0">
                <param id="V_IDSEQ">$IDINSTPRN</param>
                <param id="V_SEQUENCIA">$SEQUENCIA</param>
              </refresh-details></grid></container><container orientacao="H" tamanhoRelativo="2.5358184354000253"></container></container><container orientacao="V" tamanhoRelativo="41.81246011311371"><simple-value id="svl_2D0"><args><arg id="V_IDSEQ" type="integer"></arg><arg id="V_SEQUENCIA" type="integer"></arg></args><expression type="sql" data-source="MGEDS"><![CDATA[SELECT
HIS.IDINSTPRN
,HIS.SEQUENCIA
,HIS.DESCSOLUCAO

FROM 
AD_HISTORICOSOLUCOES HIS 
INNER JOIN AD_CHAMADOTI CHA ON (CHA.IDINSTPRN = HIS.IDINSTPRN)
INNER JOIN VWFSOLI VWS ON (VWS.IDINSTPRN = CHA.IDINSTPRN)
 LEFT JOIN TGFPRO PRD ON (PRD.CODPROD = HIS.CODPROD)
 LEFT JOIN TGFPAR PAR ON (PAR.CODPARC = HIS.CODPARC)

WHERE HIS.IDINSTPRN = :V_IDSEQ AND HIS.SEQUENCIA = :V_SEQUENCIA
ORDER BY HIS.SEQUENCIA]]></expression><metadata><field name="IDINSTPRN" label="IDINSTPRN" type="I" visible="true" useFooter="false"></field><field name="SEQUENCIA" label="SEQUENCIA" type="I" visible="true" useFooter="false"></field><field name="DESCSOLUCAO" label="DESCSOLUCAO" type="S" visible="true" useFooter="false"></field></metadata><value-expression><![CDATA[<div style="
    font-family: 'Segoe UI', Arial, sans-serif;
    font-size: 13px;
    color: #333;
    background: #ffffff;
    border-radius: 6px;
    padding: 16px 18px;
    box-shadow: 0 0 4px rgba(0,0,0,0.08);
    box-sizing: border-box;">
              <div style="font-size: 12px; font-weight: 600; color: #888; text-transform: uppercase; letter-spacing: .5px;">Detalhe do Histórico - Solução (Nro. Solicitação: $IDINSTPRN) </div>
              <div style="height: 1px; background: #eee; margin: 8px 0 10px;">
              </div>
              <div style=" background: #f5f5f5;
border-radius: 6px;
padding: 12px 14px;
font-size: 14px;
line-height: 1.5;
color: #333;
white-space: normal;
border: 1px solid #e2e2e2;
    ">
                <b>Descrição da Solução - $SEQUENCIA:</b>
                <br>$DESCSOLUCAO</div>
              </div>]]></value-expression></simple-value></container></container></container></container></level></gadget>